apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "am-document-processor.fullname" . }}-config
  labels:
    {{- include "am-document-processor.labels" . | nindent 4 }}
data:
  # Spring Profile
  SPRING_PROFILES_ACTIVE: "{{ .Values.environment }}"
  TZ: "Asia/Kolkata"

  # Database Configuration
  POSTGRES_URL: "jdbc:postgresql://{{ .Values.postgresql.fullname }}:{{ .Values.postgresql.primary.service.port }}"
  POSTGRES_DATABASE: "{{ .Values.postgresql.auth.database }}"
  # Vault Secret Paths for PostgreSQL
  POSTGRES_SECRET_PATH: "{{ .Values.vault.secretPaths.database }}"

  # Note: The following environment variables are injected by Vault Agent and don't need to be defined here:
  # - Kafka: KAFKA_* variables

  # Document Processing Configuration
  DOC_PROC_MAX_RETRIES: "{{ .Values.config.documentProcessing.maxRetries }}"
  DOC_PROC_RETRY_DELAY_MS: "{{ .Values.config.documentProcessing.retryDelayMs }}"
  DOC_PROC_THREAD_POOL_SIZE: "{{ .Values.config.documentProcessing.threadPoolSize }}"
  DOC_PROC_THREAD_QUEUE_CAPACITY: "{{ .Values.config.documentProcessing.threadQueueCapacity }}"
  DOC_PROC_STORAGE_PROVIDER: "{{ .Values.config.documentProcessing.storageProvider }}"

  # Metrics Configuration
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health,metrics,prometheus"
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "always"
  MANAGEMENT_METRICS_TAGS_APPLICATION: "document-processor-{{ .Values.environment }}"
  MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED: "{{ .Values.monitoring.prometheus.scrape }}"
